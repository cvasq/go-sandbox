## Protocol Buffers

> Protocol Buffers offer several compelling advantages over JSON for sending data over the wire between internal services. While not a wholesale replacement for JSON, especially for services which are directly consumed by a web browser, Protocol Buffers offers very real advantages not only in the ways outlined above, but also typically in terms of speed of encoding and decoding, size of the data on the wire, and more.

Source - https://codeclimate.com/blog/choose-protocol-buffers/

Basics:
- Data structures are defined in .proto files.
- The 'protoc' compiler is used to generate the struct files in Go code or a number of other languages.
- Data can then be marshalled and unmarshalled using the code (structs) generated by the 'protoc' compiler.


### Protocol Buffers Marshal to Unmarshal example

A struct is defined in the *person.proto* file
```
syntax="proto3";

package main;

message Person {
    string name = 1;
    int32 age = 2;
}
```

Compiling the .proto file(s) generates the defined structure in Go code
```
# Compile all .proto files
protoc -v --go_out=. *.proto

Output File: person.pb.go
```

We can now use the struct defined in the generated **person.pb.go** file to serialize or deserialize our data using the github.com/golang/protobuf/proto package.

#### Marshalling 

The *protobuf_person_marshal.go* example will take 2 flags at runtime (--name string and --age int). It parses and marshalls the flag input to a 'Person' type and prints the serialized data to STDOUT.

Build
```
go build protobuf_person_marshal.go person.pb.go

Output Binary: protobuf_person_marshal
```

#### Unmarshalling 

The *protobuf_person_unmarshal.go* example will read data from STDIN and attempt to unmarshall it to a 'Person' data struct type.

Build
```
go build protobuf_person_unmarshal.go person.pb.go

Output Binary: protobuf_person_unmarshal
```

#### Run

Data is marshalled in the first binary and unmarshalled in the second binary:

```
$ ./protobuf_person_marshal --name "Carlos" --age 27 | ./protobuf_person_unmarshal

New User
name: Carlos
age: 27
```